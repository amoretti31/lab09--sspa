name: Lab09 - Generate Diff

on:
  push:
    branches: [master]

permissions:
  contents: read

jobs:
  diff:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # REQUIRED for git diff

      - name: Generate diff with previous commit
        run: |
          echo "Previous commit: ${{ github.event.before }}"
          echo "Current commit:  ${{ github.sha }}"

          git diff \
            ${{ github.event.before }} \
            ${{ github.sha }} \
            > changes.diff

          echo "Diff generated:"
          wc -l changes.diff

      - name: Upload diff artifact
        uses: actions/upload-artifact@v4
        with:
          name: lab09-diff
          path: changes.diff
